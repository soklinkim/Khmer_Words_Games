<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Khmer Word Game</title>
    <style>
      body {
        font-family: "Noto Sans Khmer", sans-serif;
        background: #f0f0f0;
        display: flex;
        justify-content: center;
        align-items: flex-start;
        padding: 40px;
      }
    
    .container {
        text-align: center;
        background: white;
        padding: 30px;
        border-radius: 20px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        width: 600px;
    }
    
    h1 {
        font-size: 28px;
        margin-bottom: 20px;
        color: #333;
    }
    
    .word-image {
        width: 250px;
        height: auto;
        margin-bottom: 20px;
        border-radius: 12px;
        cursor: pointer;
        transition: transform 0.2s;
    }
    
    .word-image:hover {
        transform: scale(1.03);
    }
    
    /* Drop zone layout */
    #drop-zone {
      display: grid;
      grid-template-areas:
          ". top ."
          "left main right right2"
          ". bottom .";
      grid-template-columns: 1fr 1fr 1fr 1fr;
      grid-template-rows: auto auto auto;
      gap: 10px;
      margin: 30px 0;
      justify-content: center;
      min-height: 200px; /* üîß Add this so it doesn't collapse */
  }  
    
    .drop-box {
      width: 80px;
      height: 80px;
      font-size: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px dashed #999;
      border-radius: 10px;
      background: #fff;
  }

  
    
    .drop-box:nth-child(1) { grid-area: top; }
    .drop-box:nth-child(2) { grid-area: left; }
    .drop-box:nth-child(3) { grid-area: main; }
    .drop-box:nth-child(4) { grid-area: right; }
    .drop-box:nth-child(5) { grid-area: right2; }
    .drop-box:nth-child(6) { grid-area: bottom; }
    
    /* Draggable letters */
    .drag-area {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
        margin-bottom: 20px;
    }
    
    .drag-item {
      font-size: 60px;             /* bigger font */
      padding: 20px 24px;          /* more space around */
      background-color: #e1f5fe;
      border: 2px solid #81d4fa;
      border-radius: 12px;
      cursor: grab;
      font-weight: bold;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
  
    
    /* Result message */
    #result {
        font-size: 20px;
        margin-top: 15px;
        font-weight: bold;
    }    
      </style>
    
</head>
<body>

  <!-- Game Image -->
  <img id="game-image" src="" alt="Game Image">

  <!-- Play Audio Button -->
  <button onclick="playAudio()">üîä Play Sound</button>

  <!-- Audio Player (Hidden) -->
  <audio id="audio-player" hidden></audio>

  <div class="drop-box"></div> <!-- this will be 'top' -->
  <div class="drop-box"></div> <!-- left -->
  <div class="drop-box"></div> <!-- main -->
  <div class="drop-box"></div> <!-- right -->
  <div class="drop-box"></div> <!-- right2 -->
  <div class="drop-box"></div> <!-- bottom -->
  
  <!-- Character Bank -->
  <div id="char-bank"></div>

  <!-- Submit Button -->
  <button onclick="checkAnswer()">Submit</button>

  <!-- Result Message -->
  <div id="result"></div>

  <script>
      function initDragAndDrop() {
          const draggables = document.querySelectorAll(".drag-item");
          draggables.forEach(item => {
              item.ondragstart = (e) => {
                  e.dataTransfer.setData("text/plain", item.textContent);
              };
          });
      }
      document.querySelectorAll('.drop-box').forEach(box => {
        box.ondragover = e => e.preventDefault();
        box.ondrop = e => {
            e.preventDefault();
            const data = e.dataTransfer.getData("text/plain");
            box.textContent = data;
        };
      });
    

      function playAudio() {
          const audio = document.getElementById("audio-player");
          audio.play();
      }

      async function loadNewWord() {
          const res = await fetch('/get-word');
          const data = await res.json();

          document.getElementById('game-image').src = data.img_path;
          document.getElementById('audio-player').src = data.audio_path;

          const boxes = document.querySelectorAll('.drop-box');
          boxes.forEach(box => box.textContent = '');

          const chars = [
              data.left_char,
              data.above,
              data.main_char,
              data.below,
              data.right,
              data.right_right
          ].filter(Boolean).sort(() => Math.random() - 0.5);

          const bank = document.getElementById('char-bank');
          bank.innerHTML = '';
          chars.forEach(ch => {
              const div = document.createElement('div');
              div.className = 'drag-item';
              div.setAttribute('draggable', 'true');
              div.textContent = ch;
              bank.appendChild(div);
          });

          initDragAndDrop();
      }

      function checkAnswer() {
          const boxes = document.querySelectorAll(".drop-box");
          let user_word = "";
          boxes.forEach(box => {
              user_word += box.textContent.trim();
          });

          const result = document.getElementById("result");

          // Check if all boxes are filled
          if ([...boxes].some(box => !box.textContent.trim())) {
              result.textContent = "‚ö†Ô∏è Please fill all the boxes!";
              result.style.color = "orange";
              return;
          }

          fetch("/check", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ user_word: user_word })
          })
          .then(response => response.json())
          .then(data => {
              if (data.correct) {
                  result.textContent = "üéâ Correct! Good job!";
                  result.style.color = "green";
                  setTimeout(() => {
                      loadNewWord(); // load new word
                  }, 1500);
              } else {
                  result.textContent = `‚ùå Try again! Correct word: ${data.correct_word}`;
                  result.style.color = "red";
              }
          });
      }
      window.addEventListener('DOMContentLoaded', loadNewWord);
  </script>
</body>
</html> 
